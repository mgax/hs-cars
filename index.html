<!doctype html>
<meta charset="utf8">
<style>
html, body, #app { margin: 0; height: 100%; }
</style>
<body>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script crossorigin src="https://unpkg.com/react@16/umd/react.development.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>

<div id="app"></div>

<script type="text/babel">
const CAR_FIELDS = [
  "acceleration",
  "cylinders",
  "displacement",
  "horsepower",
  "mpg",
  "name",
  "weight",
  "year",
]

class App extends React.Component {

  constructor() {
    super()
    this.state = {}
  }

  componentDidMount() {
    this.loadPage('/api/v1/car/?format=json');
  }

  async loadPage(url) {
    let resp = await fetch(url)
    let data = await resp.json()
    this.setState({data})
  }

  render() {
    if(! this.state.data) return <p>loading...</p>
    let {meta, objects} = this.state.data
    let car = this.state.car

    let next = (e) => {
      this.loadPage(meta.next)
    }

    let previous = (e) => {
      this.loadPage(meta.previous)
    }

    let editCallback= (car) => (
      (e) => {
        e.preventDefault()
        this.setState({car})
      }
    )

    return (
      <div>
        <ul>
          {objects.map((car) => {
            return (
              <li key={car.id}>
                <a href="#" onClick={editCallback(car)}>
                  {car.name}
                </a>
              </li>
            )
          })}
        </ul>
        <p>
          {meta.previous && <button onClick={previous}>previous</button>}
          {meta.next && <button onClick={next}>next</button>}
        </p>
        {car && <Edit car={car} />}
      </div>
    )
  }
}

class Edit extends React.Component {
  render() {
    let {car} = this.props

    let save = (e) => {
      e.preventDefault()
      let data = {}
      CAR_FIELDS.forEach((field) => { data[field] = this.refs[field].value })
      console.log(data)
    }

    return (
      <form onSubmit={save}>
        {CAR_FIELDS.map((field) => (
          <div key={field}>
            <label htmlFor={`edit-${field}`}>{field}</label>
            <input id={`edit-${field}`} ref={field} defaultValue={car[field]} />
          </div>
        ))}
        <button type="submit">save</button>
      </form>
    )
  }
}

ReactDOM.render(<App/>, document.querySelector('#app'))
</script>
